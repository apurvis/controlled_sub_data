<div class='basic_info'>
   <% if @statute.is_a?(StatuteAmendment) %>
      <h2>Amends Statute: <%= link_to @statute.statute.formatted_name, statute_path(@statute.statute) %>
   <% else %>
      <h2>Title: <%= @statute.name %></h2>
   <% end %>

   <h3>State: <%= @statute.state %></h3>
   <h4>Effective Date: <%= @statute.start_date.strftime('%Y-%m-%d') %></h4>
   <h4>Expiration Date: <%= @statute.expiration_date %></h4>
   <h4>Blue Book Code: <%= @statute.blue_book_code %></h4>
   <% if @statute.duplicate_federal_as_of_date %>
      <h4>Duplicates the federal statutes as of <%= @statute.duplicate_federal_as_of_date.strftime('%Y-%m-%d') %></h4>
   <% end %>
   <h4><%= link_to "(Edit)", edit_statute_path(@statute) %></h4>
</div>

<div class='comment'>
   <h3>COMMENTS:</h3>
   <p><%= @statute.comment %></p>
</div>

<div class='scheduled_substances'>
   <h1>Changes in Scheduling Effected by This <%= !@statute.is_a?(StatuteAmendment) ? 'Statute and Its Amendments' : @statute.class %></h3>
   <h4><%= link_to @scheduled_substance_message, { controller: 'substance_statutes', action: :new, statute_id: @statute.id } %></h4>

   <% if @substance_statute_data.size > 0 %>
      <table>
         <tr>
            <th>Change Type</th>
            <th>Substance Name</th>
            <th>AKA</th>
            <th>Added By</th>
            <th>Added On</th>
            <th>Flags</th>
            <th>Expired By</th>
            <th>Scheduled Level</th>
            <th>Edit Link to Statute</th>
            <th>Delete Link to Statute</th>
         </tr>
         <% @substance_statute_data.each do |ss| %>
            <tr>
               <td><%= ss[:is_expiration] != true ? 'addition' : 'expiration' %></td>
               <td><%= link_to ss[:substance].name, substance_statute_path(ss[:substance_statute]) %></td>
               <td>
                  <%= ss[:substance_statute].substance_alternate_names.map { |san| link_to(san.name, substance_alternate_name_path(san)) }.join(', ').html_safe %>
               </td>

               <% if ss[:added_by_amendment] %>
                  <td>
                     <% if ss[:added_by_amendment].is_a?(Statute) %>
                        <%= link_to ss[:added_by_amendment].formatted_name, statute_path(ss[:added_by_amendment]) %>
                     <% else %>
                        Duplicated Federal
                     <% end %>
                  </td>
                  <td><%= ss[:start_date].strftime('%Y-%m-%d') %></td>
               <% else %>
                  <td>This Statute or Amendment</td>
                  <td>N/A</td>
               <% end %>

               <% if ss[:substance_statute].has_include_flags? %>
                  <td class='addition'><%= ss[:substance_statute].include_flags_string %></td>
               <% else %>
                  <td>None</td>
               <% end %>

               <% if ss[:expired_by_amendment] %>
                  <td><%= link_to ss[:expired_by_amendment].formatted_name, statute_path(ss[:expired_by_amendment]) %></td>
               <% else %>
                  <td></td>
               <% end %>

               <% if ss[:schedule_level] && ss[:schedule_level].is_a?(Integer) %>
                  <td class='schedule_level'><%= link_to ScheduleLevelsController::LEVELS.keys[ss[:schedule_level] - 1], { controller: "schedule_levels", action: :show, id: ss[:schedule_level] } %></td>
               <% else %>
                  <td></td>
               <% end %>

               <% unless ss[:added_by_amendment] %>
                  <td class='button'><%= link_to 'Edit', edit_substance_statute_path(ss[:substance_statute]) %></td>
                  <td class='button'><%= link_to 'Delete', substance_statute_path(ss[:substance_statute]), method: :delete, data: { confirm: "Are you sure?" } %></td>
               <% else %>
                  <td></td>
                  <td></td>
               <% end %>
            </tr>
         <% end %>
      </table>
   <% end %>
</div>

<div class='amendments'>
   <% if !@statute.is_a?(StatuteAmendment) %>
      <h1>Amendments</h1>
      <h4><%= link_to 'Add an amendment to this statute', { controller: 'statute_amendments', action: :new, parent_id: @statute.id } %></h4>

      <% if !@statute.statute_amendments.empty? %>
         <table>
            <tr>
               <th>Amendment Identifier</th>
               <th>Blue Book Code</th>
               <th>Edit</th>
               <th>Delete</th>
            </tr>

            <% @statute.statute_amendments.each do |amendment| %>
               <tr>
                  <td><%= link_to amendment.formatted_name, statute_path(amendment) %></td>
                  <td><%= amendment.blue_book_code %></td>
                  <td class='button'><%= link_to 'Edit', edit_statute_path(amendment) %></td>
                  <td class='button'><%= link_to 'Delete', statute_path(amendment), method: :delete, data: { confirm: "Are you sure?" } %></td>
               </tr>
            <% end %>
         </table>
      <% end %>
   <% end %>
</div>
